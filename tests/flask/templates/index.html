            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>ugly_midi - VexFlow JSON ‚ü∑ MIDI Converter</title>
                <style>
                    * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                    }

                    body {
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        line-height: 1.6;
                        color: #333;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        min-height: 100vh;
                        padding: 20px;
                    }

                    .container {
                        max-width: 1200px;
                        margin: 0 auto;
                        background: rgba(255, 255, 255, 0.95);
                        border-radius: 15px;
                        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                        overflow: hidden;
                    }

                    .header {
                        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
                        color: white;
                        padding: 30px;
                        text-align: center;
                    }

                    .header h1 {
                        font-size: 2.5em;
                        margin-bottom: 10px;
                        font-weight: 300;
                    }

                    .header p {
                        font-size: 1.2em;
                        opacity: 0.9;
                    }

                    .nav-tabs {
                        display: flex;
                        background: #f8f9fa;
                        border-bottom: 1px solid #dee2e6;
                    }

                    .nav-tab {
                        flex: 1;
                        padding: 15px 20px;
                        background: none;
                        border: none;
                        cursor: pointer;
                        font-size: 1em;
                        transition: all 0.3s ease;
                        border-bottom: 3px solid transparent;
                    }

                    .nav-tab:hover {
                        background: #e9ecef;
                    }

                    .nav-tab.active {
                        background: white;
                        border-bottom-color: #3498db;
                        color: #3498db;
                        font-weight: 600;
                    }

                    .tab-content {
                        display: none;
                        padding: 30px;
                        animation: fadeIn 0.3s ease-in;
                    }

                    .tab-content.active {
                        display: block;
                    }

                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    .section {
                        background: white;
                        margin-bottom: 20px;
                        padding: 25px;
                        border-radius: 10px;
                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                        border-left: 4px solid #3498db;
                    }

                    .section h3 {
                        color: #2c3e50;
                        margin-bottom: 15px;
                        font-size: 1.3em;
                    }

                    .form-group {
                        margin-bottom: 20px;
                    }

                    .form-group label {
                        display: block;
                        margin-bottom: 8px;
                        font-weight: 600;
                        color: #555;
                    }

                    .form-control {
                        width: 100%;
                        padding: 12px 15px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 1em;
                        transition: border-color 0.3s ease;
                    }

                    .form-control:focus {
                        outline: none;
                        border-color: #3498db;
                        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
                    }

                    textarea.form-control {
                        resize: vertical;
                        min-height: 200px;
                        font-family: 'Courier New', monospace;
                    }

                    .btn {
                        display: inline-block;
                        padding: 12px 25px;
                        background: linear-gradient(135deg, #3498db, #2980b9);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1em;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        text-decoration: none;
                    }

                    .btn:hover {
                        background: linear-gradient(135deg, #2980b9, #21618c);
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
                    }

                    .btn:active {
                        transform: translateY(0);
                    }

                    .btn-secondary {
                        background: linear-gradient(135deg, #6c757d, #5a6268);
                    }

                    .btn-secondary:hover {
                        background: linear-gradient(135deg, #5a6268, #495057);
                    }

                    .btn-success {
                        background: linear-gradient(135deg, #28a745, #218838);
                    }

                    .btn-success:hover {
                        background: linear-gradient(135deg, #218838, #1e7e34);
                    }

                    .file-input-wrapper {
                        position: relative;
                        display: inline-block;
                    }

                    .file-input {
                        position: absolute;
                        opacity: 0;
                        width: 100%;
                        height: 100%;
                        cursor: pointer;
                    }

                    .result {
                        margin-top: 20px;
                        padding: 15px;
                        border-radius: 8px;
                        border-left: 4px solid #28a745;
                        background: #d4edda;
                        color: #155724;
                    }

                    .error {
                        margin-top: 20px;
                        padding: 15px;
                        border-radius: 8px;
                        border-left: 4px solid #dc3545;
                        background: #f8d7da;
                        color: #721c24;
                    }

                    .info-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                        margin-top: 20px;
                    }

                    .info-card {
                        background: #f8f9fa;
                        padding: 20px;
                        border-radius: 8px;
                        border: 1px solid #e9ecef;
                    }

                    .info-card h4 {
                        color: #3498db;
                        margin-bottom: 10px;
                    }

                    .code-block {
                        background: #2c3e50;
                        color: #ecf0f1;
                        padding: 15px;
                        border-radius: 8px;
                        font-family: 'Courier New', monospace;
                        margin: 10px 0;
                        overflow-x: auto;
                        white-space: pre-wrap;
                    }

                    .loading {
                        display: none;
                        text-align: center;
                        padding: 20px;
                    }

                    .spinner {
                        border: 4px solid #f3f3f3;
                        border-top: 4px solid #3498db;
                        border-radius: 50%;
                        width: 40px;
                        height: 40px;
                        animation: spin 1s linear infinite;
                        margin: 0 auto 10px;
                    }

                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }

                    .ensemble-inputs {
                        border: 2px dashed #3498db;
                        padding: 20px;
                        border-radius: 8px;
                        margin: 15px 0;
                    }

                    .instrument-input {
                        background: #f8f9fa;
                        padding: 15px;
                        margin: 10px 0;
                        border-radius: 8px;
                        border: 1px solid #e9ecef;
                    }

                    .remove-instrument {
                        background: #dc3545;
                        color: white;
                        border: none;
                        padding: 5px 10px;
                        border-radius: 4px;
                        cursor: pointer;
                        float: right;
                    }

                    @media (max-width: 768px) {
                        .nav-tabs {
                            flex-direction: column;
                        }

                        .header h1 {
                            font-size: 2em;
                        }

                        .info-grid {
                            grid-template-columns: 1fr;
                        }
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="header">
                        <h1>üéµ ugly_midi</h1>
                        <p>VexFlow JSON ‚ü∑ MIDI Converter</p>
                    </div>

                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="showTab('converter')">Converter</button>
                        <button class="nav-tab" onclick="showTab('ensemble')">Ensemble</button>
                        <button class="nav-tab" onclick="showTab('utilities')">Utilities</button>
                        <button class="nav-tab" onclick="showTab('info')">Package Info</button>
                    </div>

                    <!-- Converter Tab -->
                    <div id="converter" class="tab-content active">
                        <div class="section">
                            <h3>üìÑ JSON to MIDI Converter</h3>
                            <div class="form-group">
                                <label for="jsonInput">VexFlow JSON Data:</label>
                                <textarea id="jsonInput" class="form-control" placeholder="Paste your VexFlow JSON here or click 'Load Sample' to get started..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="tempoOverride">Tempo Override (BPM, optional):</label>
                                <input type="number" id="tempoOverride" class="form-control" placeholder="e.g., 120" min="30" max="300">
                            </div>
                            <button class="btn" onclick="loadSampleJson()">Load Sample JSON</button>
                            <button class="btn btn-success" onclick="convertJsonToMidi()">Convert to MIDI</button>
                            <div id="jsonToMidiResult"></div>
                        </div>

                        <div class="section">
                            <h3>üéπ MIDI to JSON Converter</h3>
                            <div class="form-group">
                                <label for="midiFile">Upload MIDI File:</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="midiFile" class="file-input" accept=".mid,.midi">
                                    <button class="btn">Choose MIDI File</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="quantizeResolution">Quantization Resolution:</label>
                                <select id="quantizeResolution" class="form-control">
                                    <option value="0.25">Sixteenth Note (0.25)</option>
                                    <option value="0.125">Thirty-second Note (0.125)</option>
                                    <option value="0.5">Eighth Note (0.5)</option>
                                    <option value="1.0">Quarter Note (1.0)</option>
                                </select>
                            </div>
                            <button class="btn btn-success" onclick="convertMidiToJson()">Convert to JSON</button>
                            <div id="midiToJsonResult"></div>
                        </div>
                    </div>

                    <!-- Ensemble Tab -->
                    <div id="ensemble" class="tab-content">
                        <div class="section">
                            <h3>üéº Multi-Instrument Ensemble</h3>
                            <p>Create a multi-instrument MIDI file by combining multiple VexFlow JSON objects.</p>

                            <div class="ensemble-inputs" id="ensembleInputs">
                                <div class="instrument-input">
                                    <label>Instrument 1:</label>
                                    <textarea class="form-control instrument-json" placeholder="Paste VexFlow JSON for first instrument..."></textarea>
                                </div>
                            </div>

                            <button class="btn btn-secondary" onclick="addInstrument()">+ Add Another Instrument</button>
                            <button class="btn" onclick="loadEnsembleSample()">Load Sample Ensemble</button>
                            <button class="btn btn-success" onclick="createEnsemble()">Create Ensemble MIDI</button>

                            <div class="form-group" style="margin-top: 20px;">
                                <label for="ensembleTempoOverride">Ensemble Tempo Override (BPM, optional):</label>
                                <input type="number" id="ensembleTempoOverride" class="form-control" placeholder="e.g., 120" min="30" max="300">
                            </div>

                            <div id="ensembleResult"></div>
                        </div>
                    </div>

                    <!-- Utilities Tab -->
                    <div id="utilities" class="tab-content">
                        <div class="info-grid">
                            <div class="section">
                                <h3>üéµ Parse Note Name</h3>
                                <div class="form-group">
                                    <label for="noteNameInput">Note Name:</label>
                                    <input type="text" id="noteNameInput" class="form-control" placeholder="e.g., C4 or (C4 E4 G4)">
                                </div>
                                <button class="btn" onclick="parseNote()">Parse Note</button>
                                <div id="parseNoteResult"></div>
                            </div>

                            <div class="section">
                                <h3>‚è±Ô∏è Beats to Seconds</h3>
                                <div class="form-group">
                                    <label for="beatsInput">Beats:</label>
                                    <input type="number" id="beatsInput" class="form-control" placeholder="e.g., 1.0" step="0.25">
                                </div>
                                <div class="form-group">
                                    <label for="tempoInput">Tempo (BPM):</label>
                                    <input type="number" id="tempoInput" class="form-control" placeholder="e.g., 120">
                                </div>
                                <button class="btn" onclick="beatsToSeconds()">Convert</button>
                                <div id="beatsToSecondsResult"></div>
                            </div>

                            <div class="section">
                                <h3>üéº Determine Clef</h3>
                                <div class="form-group">
                                    <label for="midiNoteInput">MIDI Note Number:</label>
                                    <input type="number" id="midiNoteInput" class="form-control" placeholder="e.g., 60 (Middle C)" min="0" max="127">
                                </div>
                                <button class="btn" onclick="determineClef()">Determine Clef</button>
                                <div id="determineClefResult"></div>
                            </div>

                            <div class="section">
                                <h3>üéπ MIDI to Note Name</h3>
                                <div class="form-group">
                                    <label for="midiNotesInput">MIDI Note Numbers (comma-separated):</label>
                                    <input type="text" id="midiNotesInput" class="form-control" placeholder="e.g., 60,64,67">
                                </div>
                                <button class="btn" onclick="midiToNoteName()">Convert</button>
                                <div id="midiToNoteNameResult"></div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>üìä Duration Mappings</h3>
                            <button class="btn" onclick="getDurationMappings()">Show Duration Mappings</button>
                            <div id="durationMappingsResult"></div>
                        </div>
                    </div>

                    <!-- Info Tab -->
                    <div id="info" class="tab-content">
                        <div class="section">
                            <h3>üì¶ Package Information</h3>
                            <button class="btn" onclick="getPackageInfo()">Load Package Info</button>
                            <div id="packageInfoResult"></div>
                        </div>

                        <div class="section">
                            <h3>üöÄ API Documentation</h3>
                            <div class="info-grid">
                                <div class="info-card">
                                    <h4>Core Conversion</h4>
                                    <p><strong>POST /api/json-to-midi</strong><br>Convert VexFlow JSON to MIDI file</p>
                                    <p><strong>POST /api/midi-to-json</strong><br>Convert MIDI file to VexFlow JSON</p>
                                    <p><strong>POST /api/create-ensemble</strong><br>Create multi-instrument MIDI</p>
                                </div>

                                <div class="info-card">
                                    <h4>Utility Functions</h4>
                                    <p><strong>POST /api/parse-note</strong><br>Parse VexFlow note names</p>
                                    <p><strong>POST /api/beats-to-seconds</strong><br>Convert beats to seconds</p>
                                    <p><strong>POST /api/determine-clef</strong><br>Determine clef for MIDI note</p>
                                </div>

                                <div class="info-card">
                                    <h4>Information</h4>
                                    <p><strong>GET /api/duration-mappings</strong><br>Get VexFlow duration symbols</p>
                                    <p><strong>GET /api/package-info</strong><br>Get package information</p>
                                    <p><strong>GET /api/sample-json</strong><br>Get sample VexFlow JSON</p>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h3>üí° Usage Examples</h3>
                            <div class="code-block">
            // Convert JSON to MIDI
            fetch('/api/json-to-midi', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(vexflowData)
            }).then(response => response.blob())
              .then(blob => downloadFile(blob, 'song.mid'));

            // Upload MIDI, get JSON
            const formData = new FormData();
            formData.append('file', midiFile);
            fetch('/api/midi-to-json', {
                method: 'POST',
                body: formData
            }).then(response => response.json());
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // Tab functionality
                    function showTab(tabName) {
                        // Hide all tabs
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.classList.remove('active');
                        });
                        document.querySelectorAll('.nav-tab').forEach(tab => {
                            tab.classList.remove('active');
                        });

                        // Show selected tab
                        document.getElementById(tabName).classList.add('active');
                        event.target.classList.add('active');
                    }

                    // Utility functions
                    function showLoading(elementId) {
                        document.getElementById(elementId).innerHTML = `
                            <div class="loading" style="display: block;">
                                <div class="spinner"></div>
                                <p>Processing...</p>
                            </div>
                        `;
                    }

                    function showResult(elementId, content, isError = false) {
                        const className = isError ? 'error' : 'result';
                        document.getElementById(elementId).innerHTML = `<div class="${className}">${content}</div>`;
                    }

                    function downloadFile(blob, filename) {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    }

                    // API functions
                    async function loadSampleJson() {
                        try {
                            const response = await fetch('/api/sample-json');
                            const data = await response.json();
                            if (data.success) {
                                document.getElementById('jsonInput').value = JSON.stringify(data.sample_json, null, 2);
                            }
                        } catch (error) {
                            console.error('Error loading sample JSON:', error);
                        }
                    }

                    async function convertJsonToMidi() {
                        const jsonInput = document.getElementById('jsonInput').value;
                        const tempoOverride = document.getElementById('tempoOverride').value;

                        if (!jsonInput.trim()) {
                            showResult('jsonToMidiResult', 'Please enter VexFlow JSON data', true);
                            return;
                        }

                        try {
                            const jsonData = JSON.parse(jsonInput);
                            showLoading('jsonToMidiResult');

                            let url = '/api/json-to-midi';
                            if (tempoOverride) {
                                url += `?tempo=${tempoOverride}`;
                            }

                            const response = await fetch(url, {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify(jsonData)
                            });

                            if (response.ok) {
                                const blob = await response.blob();
                                const instrument = jsonData.instrument || 'song';
                                downloadFile(blob, `${instrument}.mid`);
                                showResult('jsonToMidiResult', `‚úì Successfully converted to MIDI! File downloaded as ${instrument}.mid`);
                            } else {
                                const error = await response.json();
                                showResult('jsonToMidiResult', `Error: ${error.error}`, true);
                            }
                        } catch (error) {
                            showResult('jsonToMidiResult', `Error: ${error.message}`, true);
                        }
                    }

                    async function convertMidiToJson() {
                        const fileInput = document.getElementById('midiFile');
                        const quantize = document.getElementById('quantizeResolution').value;

                        if (!fileInput.files[0]) {
                            showResult('midiToJsonResult', 'Please select a MIDI file', true);
                            return;
                        }

                        try {
                            showLoading('midiToJsonResult');

                            const formData = new FormData();
                            formData.append('file', fileInput.files[0]);
                            formData.append('quantize', quantize);

                            const response = await fetch('/api/midi-to-json', {
                                method: 'POST',
                                body: formData
                            });

                            const data = await response.json();

                            if (data.success) {
                                const jsonOutput = JSON.stringify(data.json_data, null, 2);
                                showResult('midiToJsonResult', `
                                    ‚úì Successfully converted ${data.filename} to JSON!<br>
                                    <textarea class="form-control" rows="10" readonly>${jsonOutput}</textarea>
                                `);
                            } else {
                                showResult('midiToJsonResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('midiToJsonResult', `Error: ${error.message}`, true);
                        }
                    }

                    // Ensemble functions
                    let instrumentCount = 1;

                    function addInstrument() {
                        instrumentCount++;
                        const ensembleInputs = document.getElementById('ensembleInputs');
                        const newInstrument = document.createElement('div');
                        newInstrument.className = 'instrument-input';
                        newInstrument.innerHTML = `
                            <button class="remove-instrument" onclick="removeInstrument(this)">√ó</button>
                            <label>Instrument ${instrumentCount}:</label>
                            <textarea class="form-control instrument-json" placeholder="Paste VexFlow JSON for instrument ${instrumentCount}..."></textarea>
                        `;
                        ensembleInputs.appendChild(newInstrument);
                    }

                    function removeInstrument(button) {
                        button.parentElement.remove();
                    }

                    async function loadEnsembleSample() {
                        const pianoJson = {
                            "keySignature": "C",
                            "tempo": 100,
                            "timeSignature": {"numerator": 4, "denominator": 4},
                            "instrument": "piano",
                            "midiChannel": "0",
                            "measures": [[{
                                "id": "piano-1",
                                "name": "(C4 E4 G4)",
                                "clef": "treble",
                                "duration": "w",
                                "measure": 0,
                                "isRest": false
                            }]]
                        };

                        const guitarJson = {
                            "keySignature": "C",
                            "tempo": 100,
                            "timeSignature": {"numerator": 4, "denominator": 4},
                            "instrument": "guitar",
                            "midiChannel": "1",
                            "measures": [[{
                                "id": "guitar-1",
                                "name": "C3",
                                "clef": "bass",
                                "duration": "w",
                                "measure": 0,
                                "isRest": false
                            }]]
                        };

                        const textareas = document.querySelectorAll('.instrument-json');
                        if (textareas.length >= 1) textareas[0].value = JSON.stringify(pianoJson, null, 2);
                        if (textareas.length >= 2) textareas[1].value = JSON.stringify(guitarJson, null, 2);

                        if (textareas.length < 2) {
                            addInstrument();
                            const newTextareas = document.querySelectorAll('.instrument-json');
                            newTextareas[1].value = JSON.stringify(guitarJson, null, 2);
                        }
                    }

                    async function createEnsemble() {
                        const textareas = document.querySelectorAll('.instrument-json');
                        const tempoOverride = document.getElementById('ensembleTempoOverride').value;

                        const instruments = [];

                        for (let textarea of textareas) {
                            const value = textarea.value.trim();
                            if (value) {
                                try {
                                    instruments.push(JSON.parse(value));
                                } catch (error) {
                                    showResult('ensembleResult', `Error parsing JSON in one of the instruments: ${error.message}`, true);
                                    return;
                                }
                            }
                        }

                        if (instruments.length === 0) {
                            showResult('ensembleResult', 'Please add at least one instrument', true);
                            return;
                        }

                        try {
                            showLoading('ensembleResult');

                            const requestData = { instruments };
                            if (tempoOverride) {
                                requestData.tempo = parseInt(tempoOverride);
                            }

                            const response = await fetch('/api/create-ensemble', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify(requestData)
                            });

                            if (response.ok) {
                                const blob = await response.blob();
                                const instrumentNames = instruments.map(i => i.instrument || 'unknown').join('_');
                                const filename = `ensemble_${instrumentNames}.mid`;
                                downloadFile(blob, filename);
                                showResult('ensembleResult', `‚úì Successfully created ensemble with ${instruments.length} instruments! File downloaded as ${filename}`);
                            } else {
                                const error = await response.json();
                                showResult('ensembleResult', `Error: ${error.error}`, true);
                            }
                        } catch (error) {
                            showResult('ensembleResult', `Error: ${error.message}`, true);
                        }
                    }

                    // Utility API functions
                    async function parseNote() {
                        const noteName = document.getElementById('noteNameInput').value;
                        if (!noteName) {
                            showResult('parseNoteResult', 'Please enter a note name', true);
                            return;
                        }

                        try {
                            const response = await fetch('/api/parse-note', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ note_name: noteName })
                            });

                            const data = await response.json();
                            if (data.success) {
                                showResult('parseNoteResult', `
                                    ‚úì Parsed "${data.note_name}"<br>
                                    MIDI Notes: ${data.midi_notes.join(', ')}<br>
                                    Count: ${data.note_count} note(s)
                                `);
                            } else {
                                showResult('parseNoteResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('parseNoteResult', `Error: ${error.message}`, true);
                        }
                    }

                    async function beatsToSeconds() {
                        const beats = document.getElementById('beatsInput').value;
                        const tempo = document.getElementById('tempoInput').value;

                        if (!beats || !tempo) {
                            showResult('beatsToSecondsResult', 'Please enter both beats and tempo', true);
                            return;
                        }

                        try {
                            const response = await fetch('/api/beats-to-seconds', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ beats: parseFloat(beats), tempo: parseInt(tempo) })
                            });

                            const data = await response.json();
                            if (data.success) {
                                showResult('beatsToSecondsResult', `
                                    ‚úì ${data.beats} beats at ${data.tempo} BPM = ${data.seconds.toFixed(3)} seconds
                                `);
                            } else {
                                showResult('beatsToSecondsResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('beatsToSecondsResult', `Error: ${error.message}`, true);
                        }
                    }

                    async function determineClef() {
                        const midiNote = document.getElementById('midiNoteInput').value;

                        if (!midiNote) {
                            showResult('determineClefResult', 'Please enter a MIDI note number', true);
                            return;
                        }

                        try {
                            const response = await fetch('/api/determine-clef', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ midi_note: parseInt(midiNote) })
                            });

                            const data = await response.json();
                            if (data.success) {
                                showResult('determineClefResult', `
                                    ‚úì MIDI note ${data.midi_note} ‚Üí ${data.clef} clef
                                `);
                            } else {
                                showResult('determineClefResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('determineClefResult', `Error: ${error.message}`, true);
                        }
                    }

                    async function midiToNoteName() {
                        const midiNotesInput = document.getElementById('midiNotesInput').value;

                        if (!midiNotesInput) {
                            showResult('midiToNoteNameResult', 'Please enter MIDI note numbers', true);
                            return;
                        }

                        try {
                            const midiNotes = midiNotesInput.split(',').map(n => parseInt(n.trim()));

                            const response = await fetch('/api/midi-to-note-name', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ midi_notes: midiNotes })
                            });

                            const data = await response.json();
                            if (data.success) {
                                const chordText = data.is_chord ? ' (chord)' : ' (single note)';
                                showResult('midiToNoteNameResult', `
                                    ‚úì MIDI notes [${data.midi_notes.join(', ')}] ‚Üí "${data.note_name}"${chordText}
                                `);
                            } else {
                                showResult('midiToNoteNameResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('midiToNoteNameResult', `Error: ${error.message}`, true);
                        }
                    }

                    async function getDurationMappings() {
                        try {
                            const response = await fetch('/api/duration-mappings');
                            const data = await response.json();

                            if (data.success) {
                                let mappingsHtml = '<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
                                mappingsHtml += '<tr style="background: #f8f9fa;"><th style="padding: 8px; border: 1px solid #dee2e6;">Symbol</th><th style="padding: 8px; border: 1px solid #dee2e6;">Duration (beats)</th><th style="padding: 8px; border: 1px solid #dee2e6;">Note Type</th></tr>';

                                const noteTypes = {
                                    'w': 'Whole Note',
                                    'h': 'Half Note',
                                    'q': 'Quarter Note',
                                    '8': 'Eighth Note',
                                    '16': 'Sixteenth Note',
                                    '32': 'Thirty-second Note',
                                    'w.': 'Dotted Whole',
                                    'h.': 'Dotted Half',
                                    'q.': 'Dotted Quarter',
                                    '8.': 'Dotted Eighth',
                                    '16.': 'Dotted Sixteenth'
                                };

                                for (const [symbol, beats] of Object.entries(data.duration_mappings)) {
                                    mappingsHtml += `<tr><td style="padding: 8px; border: 1px solid #dee2e6; font-family: monospace;">${symbol}</td><td style="padding: 8px; border: 1px solid #dee2e6;">${beats}</td><td style="padding: 8px; border: 1px solid #dee2e6;">${noteTypes[symbol] || 'Unknown'}</td></tr>`;
                                }
                                mappingsHtml += '</table>';

                                showResult('durationMappingsResult', `‚úì VexFlow Duration Mappings:${mappingsHtml}`);
                            } else {
                                showResult('durationMappingsResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('durationMappingsResult', `Error: ${error.message}`, true);
                        }
                    }

                    async function getPackageInfo() {
                        try {
                            const response = await fetch('/api/package-info');
                            const data = await response.json();

                            if (data.success) {
                                const info = data.package_info;
                                showResult('packageInfoResult', `
                                    ‚úì Package Information:<br>
                                    <strong>Name:</strong> ${info.name}<br>
                                    <strong>Version:</strong> ${info.version}<br>
                                    <strong>Author:</strong> ${info.author}<br>
                                    <strong>Email:</strong> ${info.email}<br>
                                    <strong>License:</strong> ${info.license}
                                `);
                            } else {
                                showResult('packageInfoResult', `Error: ${data.error}`, true);
                            }
                        } catch (error) {
                            showResult('packageInfoResult', `Error: ${error.message}`, true);
                        }
                    }

                    // Initialize page
                    document.addEventListener('DOMContentLoaded', function() {
                        // Auto-load sample JSON on page load
                        loadSampleJson();

                        // Auto-load package info
                        getPackageInfo();
                    });
                </script>
            </body>
            </html>